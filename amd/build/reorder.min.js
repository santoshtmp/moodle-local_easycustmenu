define("local_easycustmenu/reorder",["exports","jquery","core/sortable_list","core/ajax"],(function(_exports,_jquery,_sortable_list,_ajax){function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}
/**
   * AMD module
   *
   * @copyright  2025 https://santoshmagar.com.np/
   * @author     santoshtmp7 https://github.com/santoshtmp/moodle-local_easycustmenu
   * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
   *
   */Object.defineProperty(_exports,"__esModule",{value:!0}),_exports.init=void 0,_jquery=_interopRequireDefault(_jquery),_sortable_list=_interopRequireDefault(_sortable_list),_ajax=_interopRequireDefault(_ajax);_exports.init=tableid=>{let elementSelector="#"+tableid+' tbody[data-action="reorder"]';new _sortable_list.default(elementSelector,{targetListSelector:null,moveHandlerSelector:"[data-drag-type=move]",isHorizontal:!1,autoScroll:!0}),(0,_jquery.default)(elementSelector).on(_sortable_list.default.EVENTS.DROP,(function(evt,info){let element=info.element,end_x=info.endX,start_x=info.startX,positionChanged=info.positionChanged,itemDepth=parseInt(element.attr("data-depth"))||0,new_itemDepth=itemDepth,prevElement=element.prev(),prevElementDepth=parseInt(prevElement.attr("data-depth"))||0;if(positionChanged){let elementIndex=(0,_jquery.default)(elementSelector+" tr").index(element),targetNextElementDepth=parseInt(info.targetNextElement.attr("data-depth"))||0;new_itemDepth=0==elementIndex?0:Math.max(prevElementDepth,targetNextElementDepth)}else prevElement.length&&(end_x>start_x+30?new_itemDepth=Math.min(itemDepth+1,prevElementDepth+1):end_x<start_x-30&&(new_itemDepth=Math.max(0,itemDepth-1)));if(new_itemDepth!==itemDepth){element.attr("data-depth",new_itemDepth),element.find(".indentation").css({width:30*new_itemDepth+"px"})}(0,_jquery.default)("#save_menu_reorder").show()})),(0,_jquery.default)("#save_menu_reorder").on("click",(function(){let saveBtn=(0,_jquery.default)(this);saveBtn.prop("disabled",!0);let reorder_items={},depthStack={};(0,_jquery.default)(elementSelector+" tr").each((function(index){let id=parseInt((0,_jquery.default)(this).attr("data-id")),depth=parseInt((0,_jquery.default)(this).attr("data-depth"));depthStack[depth]=id;let parent=0;depth>0&&(parent=depthStack[depth-1]||0),(0,_jquery.default)(this).attr("data-parent",parent),reorder_items[id]={menu_order:index,id:id,depth:depth,parent:parent}}));let request={methodname:"local_easycustmenu_save_menu_order",args:{items:reorder_items}},ajax=_ajax.default.call([request])[0];ajax.done((function(response){response.status?(window.console.log("Menu order saved successfully."),(0,_jquery.default)("#save_menu_reorder").hide()):window.console.log("Error saving menu order:",response.message)})),ajax.fail((function(){window.console.log("request failed.")})),ajax.always((function(){saveBtn.prop("disabled",!1)}))}))}}));

//# sourceMappingURL=reorder.min.js.map